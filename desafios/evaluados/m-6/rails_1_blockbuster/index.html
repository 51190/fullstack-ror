<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Desafio evaluado: M6 - 1</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/vs2015.min.css">
  <link rel="stylesheet" href="assets/style.css">
</head>

<body>
  <div class="doc-body">
    <h1 align="center">Desaf칤o evaluado: M6 1. BlockBuster</h1><br>
    <h4 align="center"><small>Marco Contreras</small></h4>

    <h2>Requerimiento 1</h2>

    <p>Set-up inicial del proyecto, el proyecto viene con algunos errores que deben ser corregidos</p>
 
      <button id="download_btn" class="download" onclick="{this.textContent='Descargando...'; download_file('../../../../assets/zip/apoyo_desafio_blockbuster.zip')}">Material de apoyo</button>
   <p>Tenemos que fijarnos en la versi칩n que se creo el proyecto el material de apoyo:</p>
  <fieldset class="first">
    <legend align="center"><strong>Levantar el servidor</strong></legend>
    <div class="highlight">
      <pre><code class="bash hljs">rails server</code></pre>
      <enidev-button></enidev-button>
    </div>
  </fieldset>
<blockquote>Podemos observar en la terminal que si tenemos la versi칩n que indica se ejecutar치 el servidor pero nos pedira instalar las dependencias, de lo contrario nos mostrar치 un mensaje. <strong>Ejemplo:</strong>
  <br><br>
  <div class="highlight">
    <pre><code class="bash hljs">Your Ruby version is 3.0.3, but your Gemfile specified 3.1.1</code></pre>
  </div>
</blockquote>
<p>Si ese es el caso, debemos cambiar a la versi칩n de Ruby que tenemos en el sistema y luego ejecutamos el comando para instalar las dependencias:</p>
  <figure>
    <img src="assets/gemfile.png" alt="gemfile">
    <figcaption>captura de pantalla: gemfile</figcaption>
  </figure>
  <fieldset class="first">
    <legend align="center"><strong>Instalar dependencias</strong></legend>
    <div class="highlight">
      <pre><code class="bash hljs">bundle install</code></pre>
      <enidev-button></enidev-button>
    </div>
  </fieldset>
  <blockquote>Esto puede tardar varios segundos o minutos</blockquote>
  <p>Bueno ahora repetimos el primer paso, para lanzar el servidor usando el comando: <code style="font-size:17px"><mark>rails server</mark></code> <br>y entramos a  <a href="http://localhost:3000" target="_blank" class="link">http://localhost:3000</a></p>

  <figure>
    <img src="./assets/01.png" alt="lanzando el servidor">
    <figcaption>captura de pantalla: lanzando el servidor</figcaption>
  </figure>
<p>El mensaje es claro, no se pudo establecer conexi칩n con el servidor de Postgres, para solucionarlo debemos agregar nuestros datos de conexi칩n en <span class="path">config/database.yml</span>:</p>
  <fieldset class="first">
    <legend align="center"><strong>Agregar datos de conexi칩n</strong></legend>
    <div class="highlight">
      <pre>
<code class="yml hljs yml_db">default: &default
  adapter: postgresql
  encoding: unicode
  username: postgres # 游녣 tu usuario para postgres
  password: postgres # 游녣 tu password para postgres
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %></code></pre>
      <enidev-button></enidev-button>
    </div>
  </fieldset>
  <p>Para comprobar que est치 correcta nuestra conexi칩n con Postgres, ejecutamos el comando para crear la base de datos:</p>
  <fieldset class="first">
    <legend align="center"><strong>Crear la base de datos</strong></legend>
    <div class="highlight">
      <pre><code class="bash hljs">rails db:create</code></pre>
      <enidev-button></enidev-button>
    </div>
    </fieldset>
<p>
  Volvemos a lanzar el servidor, y veremos otro error pero se trata de que a칰n no se han creado las tablas y existen archivos de migraci칩n pendientes por ejecutar. Simplemente presionamos el bot칩n que nos ofrece para correr las migraciones:
</p>
<figure>
  <img src="assets/03.png" alt="migraciones">
  <figcaption>captura de pantalla: correr las migraciones</figcaption>
</figure>

<p>Ya estar칤a mostrando el proyecto de forma normal y con esto se corrigieron los errores que se mencionaban al comienzo</p>

<figure>
  <img src="assets/04.png" alt="interfaz del proyecto" style="box-shadow: 3px 4px 12px #00000018;">
  <figcaption>captura de pantalla: proyecto funcionando</figcaption>
</figure>
<h2>Requerimiento 2</h2>
<p class="req">Al editar una pel칤cula se le puede asignar un cliente</p>
<p>Primero que nada, debemos crear un cliente:</p>
<figure>
  <img src="assets/crear-cliente.png" alt="crear cliente" style="box-shadow: 3px 4px 12px #00000018;">
  <figcaption>captura de pantalla: creando un cliente</figcaption>
</figure>
<p>Segundo, nos cambiamos a la vista de Pel칤culas (<em>movies</em>) y presionamos en crear una pel칤cula:</p>
<figure>
  <img src="assets/crear-pelicula.png" alt="crear pelicula" style="box-shadow: 3px 4px 12px #00000018;">
  <figcaption>captura de pantalla: creando una pel칤cula</figcaption>
</figure>
<p>Si nos fijamos al momento de haber creado la pel칤cula ya la estamos asignando a un cliente. Una vez creado nos enviar치 a la vista del detalle donde podemos encontrar el link para editar la misma:</p>
<figure>
  <img src="assets/editar-pelicula-1.png" alt="editar pelicula" style="box-shadow: 3px 4px 12px #00000018;">
  <figcaption>captura de pantalla: link para editar una pel칤cula</figcaption>
</figure>
<p>Previamente creamos otro usuario para que nos muestre la lista con m치s de un usuario al momento de editar la pel칤cula:</p>
<figure>
  <img src="assets/editar-pelicula-2.png" alt="editar pelicula" style="box-shadow: 3px 4px 12px #00000018;">
  <figcaption>captura de pantalla: asignar un usuario a una pel칤cula</figcaption>
</figure>
<h2>Requerimiento 3</h2>
<p class="req">El index de clientes debe mostrar si un cliente tiene una pelicula arrendada</p>
<p>Para eso nos dirigimos a la vista <span class="path">app/views/clients/_client.html.erb</span> y a침adimos lo siguiente:</p>
<fieldset class="first">
  <legend align="center"><strong>
    partial - _client.html.erb
  </strong></legend>
  <div class="highlight">
    <pre>
<code class="erb hljs">&lt;div id="<%= dom_id client %>"&gt;
  &lt;tr&gt;
    &lt;th scope="row"&gt;
      <%= client.id %>
    &lt;/th&gt;
    &lt;td&gt;
      <%= client.name %>
    &lt;/td&gt;
    &lt;td&gt;
      <%= client.age %>
    &lt;/td&gt;
    &lt;td&gt;
    <% if client.movies.present? %>
      <%= select_tag 'movies' , options_for_select(client.movies), class: 'form-select' %>
    <% else %>
      No tiene pel칤cula arrendada
    <% end %>
    &lt;/td&gt;
    &lt;td align="center"&gt;
      <%= link_to "Ver cliente" , client, class: 'btn btn-info' %>
    &lt;/td&gt;
    &lt;td align="center"&gt;
      <%= link_to edit_client_path(client) do %>
        &lt;i class="fa fa-pen bg-warning rounded p-2 text-dark"&gt;&lt;/i&gt;
      <% end %>
    &lt;/td&gt;
    &lt;td align="center"&gt;
      <%= button_to @client, method: :delete, class: 'border-0 bg-body' do %>
        &lt;i class="fa fa-times bg-danger rounded p-2 text-light"&gt;&lt;/i&gt;
      <% end %>
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/div&gt;</code></pre>
<enidev-button></enidev-button>
  </div>
</fieldset>
<p>Como tenemos iconos de <a href="https://fontawesome.com/" class="link" target="_blank">Font Awesome</a> tenemos que a침adir la <abbr title="content delivery network">CDN</abbr> en <span class="path">app/views/layouts/application.html.erb</span>:</p>
<fieldset class="first">
  <legend align="center">
    <strong>Layout principal</strong>
  </legend>
  <div class="highlight">
    <pre><code class="html hljs app">&lt;script src="https://kit.fontawesome.com/6b8f0c7049.js" crossorigin="anonymous"&gt;&lt;/script&gt;</code></pre>
    <enidev-button></enidev-button>
  </div>
</fieldset>
<h2>Requerimiento 4</h2>
<p class="req">Modificar el dise침o de la aplicaci칩n, no puede ser igual al entregado en el proyecto</p>
<p>En el requerimiento anterior ya hab칤amos modificado la vista de pel칤cula un poco, asi que ahora continuamos pero agregando lo siguiente en <span class="path">app/views/clients/index.html.erb</span>:</p>
<fieldset class="first">
  <legend align="center">
    <strong>Index - Clientes</strong>
  </legend>
    <div class="highlight">
      <pre><code class="erb hljs">&lt;p style="color: green"&gt;
  <%= notice %>
&lt;/p&gt;
&lt;div class="container"&gt;
  &lt;h1 align="center" class=""&gt;Clientes&lt;/h1&gt;
  <%= link_to new_client_path, class:"text-decoration-none" do %>
    &lt;i class="fa fa-plus-circle fs-4"&gt;&lt;/i&gt;
    &lt;span&gt;Cliente&lt;/span&gt;
    <% end %>
    &lt;div id="clients"&gt;
      &lt;table class="table table-bordered">
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th scope="col"&gt;#&lt;/th&gt;
            &lt;th scope="col"&gt;Nombre&lt;/th&gt;
            &lt;th scope="col"&gt;Edad&lt;/th&gt;
            &lt;th scope="col"&gt;Pel칤cula&lt;/th&gt;
            &lt;th scope="col" colspan="3"&gt;&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          <%= render @clients %>
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
<enidev-button></enidev-button>
    </div>
</fieldset>
<figure>
  <img src="assets/vista-clientes2.png" alt="vista clientes2" style="box-shadow: 3px 4px 12px #00000018;"/>
  <figcaption>captura de pantalla: vista clientes, estilos modificados demarcados en rojo</figcaption>
</figure>
<p>Ahora vamos a modificar la vista en <span class="path">app/views/clients/new.html.erb</span> y a침adimos lo siguiente:</p>
<fieldset class="first">
  <legend align="center">
    <strong>New - Clientes</strong>
  </legend>
    <div class="highlight">
      <pre><code class="html hljs">&lt;h2 align="center"&gt;Cliente nuevo&lt;/h2&gt;
&lt;div class="row"&gt;
  &lt;div class="col-10 col-md-6 mx-auto"&gt;
    &lt;%= render "form", client: @client %&gt;
    &lt;br&gt;
    &lt;%= link_to "Volver a clientes", clients_path, class: "btn btn-info" %&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
  <enidev-button></enidev-button>
    </div>
</fieldset>
<p>Ahora lo mismo, pero modificamos el archivo <span class="path">app/views/clients/_form.html.erb</span>:</p>
<fieldset>
  <legend align="center">
    <strong>partial _form - Clientes</strong>
  </legend>
  <div class="highlight">
    <pre><code class="html hljs"><%= form_with(model: client) do |form| %>
  <% if client.errors.any? %>
  &lt;div style="color: red"&gt;
    &lt;h2&gt;
      <%= pluralize(client.errors.count, "error" ) %> prohibited this client from being saved:
    &lt;/h2&gt;
    &lt;ul&gt;
      <% client.errors.each do |error| %>
        &lt;li&gt;
          <%= error.full_message %>
        &lt;/li&gt;
      <% end %>
    &lt;/ul&gt;
  &lt;/div&gt;
  <% end %>
  &lt;div&gt;
    <%= form.label :name, "Nombre" , style: "display: block" %>
    <%= form.text_field :name, class: "form-control" %>
  &lt;/div&gt;
  &lt;div class="mb-3"&gt;
    <%= form.label :age, "Edad" , style: "display: block" %>
    <%= form.text_field :age, class: "form-control" %>
  &lt;/div&gt;
  &lt;div&gt;
      <%= form.submit class: "btn btn-success" %>
  &lt;/div&gt;
<% end %></code></pre>
<enidev-button></enidev-button>
  </div>
</fieldset>
<p>Ahora remplazamos el contenido en <span class="path">config/locales/en.yml</span>:</p>
<fielsed class="first">
  <legend align="center">
    <strong>Traducir mensajes</strong>
  </legend>
  <div class="highlight">
    <pre><code class="yml hljs">en:
  activerecord:
    models:
      client: cliente
      movie: "pel칤cula"
    helpers:
      submit:
        create: "Crear %{model}"
        update: "Actualizar cambios en %{model}"</code></pre>
  <enidev-button></enidev-button>
  </div>
</fielsed>
<p>Y como resultado tenemos la vista de nuevo cliente mejorada:</p>
<figure>
  <img src="assets/clientes-new.png" alt="vista new de clientes" style="box-shadow: 3px 4px 12px #00000018;">
  <figcaption>captura de pantalla: vista de nuevo cliente</figcaption>
</figure>
  <p>Ahora le toca al turno a la vista de editar <span class="path">app/views/clients/edit.html.erb</span>:</p>
  <fieldset class="first">
    <legend align="center"><strong>Edit - Clientes</strong></legend>
    <div class="highlight">
      <pre><code class="hljs html">&lt;h2 align="center"&gt;Editar cliente&lt;/h2&gt;
&lt;div class="row"&gt;
  &lt;div class="col-10 col-md-6 mx-auto"&gt;
    <%= render "form" , client: @client %>
    &lt;br&gt;
    <%= link_to "Volver a clientes" , clients_path, class: "btn btn-info" %>
    <%= link_to "Ver cliente" , @client, class: "btn btn-primary" %>
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<enidev-button></enidev-button>
    </div>
  </fieldset>
  <p>Y como resultado, tenemos la vista de editar cliente mejorada:</p>
  <figure>
    <img src="assets/clientes-edit.png" alt="vista edit de clientes" style="box-shadow: 3px 4px 12px #00000018;">
    <figcaption>captura de pantalla: vista de editar cliente</figcaption>
  </figure>
  </div>
  <script type="module" src="./assets/script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>
    hljs.highlightAll()
    const btn_download = document.getElementById("download_btn");
    const download_file = (url) => {
      // DRIVE RESOURCE: https://drive.google.com/uc?export=download&confirm=t&id=1JnboGpZ_PdTf26R1So7o-2dkZYqa7nIa
      fetch(url, { 
        method: "GET",
        mode: "cors"
      })
      .then(response => {
        return response.blob()
      })
      .then(blob => {
        console.log(blob)
        let url = window.URL.createObjectURL(blob);
        let a = document.createElement("a");
        a.style.display = "none";
        a.href = url;
        // a.setAttribute('href', 'data:text/plain;base64,' + blob);
        a.download = "Apoyo_BluckBuster.zip"
        a.click();
        window.URL.revokeObjectURL(url);
        btn_download.textContent = "Material de Apoyo"
      }).catch((e) => alert(e.message))
    }
  </script>
</body>


</html>